# 股票投资学习笔记 04：风险管理与投资组合理论

## 风险的数学定义与分类

### 现代投资组合理论（MPT）中的风险定义

根据 Harry Markowitz 的现代投资组合理论，投资风险被定义为资产收益的波动性，通过收益率的方差（Variance）或标准差（Standard Deviation）来量化：

$$ \sigma^2 = E[(R - E[R])^2] $$
$$ \sigma = \sqrt{\sigma^2} $$

其中：
- $R$：资产收益率
- $E[R]$：期望收益率
- $\sigma^2$：方差
- $\sigma$：标准差

这种基于波动性的风险定义假设投资者是风险厌恶的，即在其他条件相同的情况下，偏好较低的波动。

### 风险的二分法：系统性与非系统性风险

根据资本资产定价模型（CAPM），总风险（$\sigma_{total}$）可分解为：

$$ \sigma_{total}^2 = \sigma_{systematic}^2 + \sigma_{unsystematic}^2 $$

**系统性风险（Systematic Risk）**：
- 也称为市场风险或不可分散风险
- 源于宏观经济因素（利率、通货膨胀、经济周期、政治事件等）
- 影响整个市场或绝大多数资产
- 无法通过分散化消除
- 用 Beta（$\beta$）衡量：$\beta = \frac{Cov(R_i, R_m)}{Var(R_m)}$

**非系统性风险（Unsystematic Risk）**：
- 也称为特质风险或可分散风险
- 源于特定公司或行业的因素
- 影响单个或少数资产
- 可以通过充分分散化消除

### 有效前沿（Efficient Frontier）

投资组合理论的核心结论是：在风险-收益空间中，存在一个有效前沿，该前沿上的投资组合在给定的风险水平下提供最高的期望收益，或在给定的收益水平下承担最小的风险。

数学上，对于包含 N 个资产的投资组合，其期望收益和方差为：

$$ E[R_p] = \sum_{i=1}^{N} w_i E[R_i] $$
$$ \sigma_p^2 = \sum_{i=1}^{N} \sum_{j=1}^{N} w_i w_j \sigma_{ij} = \sum_{i=1}^{N} w_i^2 \sigma_i^2 + \sum_{i \neq j} w_i w_j \rho_{ij} \sigma_i \sigma_j $$

其中：
- $w_i$：资产 i 的权重
- $\sigma_{ij}$：资产 i 和 j 的协方差
- $\rho_{ij}$：相关系数

有效前沿可通过优化问题求解：
$$ \min \sigma_p^2 \quad \text{s.t.} \quad E[R_p] \geq R_{target} $$
或
$$ \max E[R_p] \quad \text{s.t.} \quad \sigma_p^2 \leq \sigma_{target}^2 $$

### 分散化的数学证明

分散化的有效性可以通过方差公式直观地理解。假设等权重投资组合，资产收益互不独立且具有相同的相关系数 $\rho$，则：

$$ \sigma_p^2 = \frac{\bar{\sigma}^2}{N} + \frac{N-1}{N} \rho \bar{\sigma}^2 $$

当 $N \to \infty$ 时：
$$ \lim_{N \to \infty} \sigma_p^2 = \rho \bar{\sigma}^2 $$

**结论**：
- 随着资产数量增加，组合风险降低
- 极限风险取决于资产间的相关系数 $\rho$
- 若 $\rho = 1$（完全正相关），分散化无效
- 若 $\rho = 0$（不相关），非系统性风险可完全消除
- 若 $\rho < 0$（负相关），分散化效果最佳

### CAPM 与风险定价

根据 CAPM，资产的期望收益仅与其承担的系统性风险（Beta）相关：

$$ E[R_i] = R_f + \beta_i (E[R_m] - R_f) $$

其中：
- $R_f$：无风险利率
- $E[R_m]$：市场组合期望收益
- $E[R_m] - R_f$：市场风险溢价（Market Risk Premium）

**推论**：在均衡市场中，投资者不会为承担非系统性风险获得补偿，因为这种风险可以通过分散化免费消除。只有系统性风险需要补偿。

## 仓位管理理论

### 凯利公式（Kelly Criterion）

凯利公式来源于信息论，用于确定在期望收益为正的博弈中每次应投入的最优资金比例：

$$ f^* = \frac{p}{b} - \frac{q}{b} = \frac{bp - q}{b} = \frac{p(b+1) - 1}{b} $$

其中：
- $f^*$：最优下注比例
- $p$：获胜概率
- $q = 1-p$：失败概率
- $b$：赔率（净赔率，如2:1赔率则 $b=2$）

在连续投资场景下，凯利公式为：
$$ f^* = \frac{\mu - r_f}{\sigma^2} $$

其中 $\mu$ 为期望收益。

**实际应用**：
- 股票投资中的 $p$ 和 $b$ 难以精确估计
- 全仓凯利可能导致巨大波动
- 实务中常用**半凯利（Half-Kelly）**以降低波动

### 风险平价（Risk Parity）

风险平价策略的核心思想是：根据资产对组合风险的贡献，而非市值，分配资金。

对于资产 i 的风险贡献（Marginal Risk Contribution）：
$$ MRC_i = w_i \times \frac{\partial \sigma_p}{\partial w_i} $$

风险平价要求：
$$ MRC_1 = MRC_2 = \dots = MRC_N $$

这导致波动率高的资产权重较低，波动率低的资产权重较高。

**示例**：60/40 股债组合
- 传统配置：60% 股票，40% 债券
- 但股票波动约为债券的3倍，因此风险贡献比例约为 82% / 18%
- 风险平价配置可能为：18% 股票，82% 债券（使风险贡献各50%）

## 止损机制与下行风险保护

### 下行风险的替代度量

传统方差（或标准差）对称地衡量上行和下行波动，但投资者通常更关注下行风险。常用的替代指标包括：

**1. 半方差（Semi-variance）**：
$$ \sigma_{-}^2 = E[(min(R - E[R], 0))^2] $$
只计算低于均值的收益波动。

**2. 下行风险（Downside Risk, DR）**：
$$ DR = \sqrt{\frac{1}{T} \sum_{t=1}^{T} min(R_t - R_{target}, 0)^2} $$
其中 $R_{target}$ 可设为无风险利率或目标收益。

**3. 最大回撤（Maximum Drawdown, MDD）**：
$$ MDD = \max_{t_1 < t_2} \left( \frac{P_{t_2} - P_{t_1}}{P_{t_1}} \right) $$
衡量从峰值到谷底的最大跌幅。

**4. VaR（Value at Risk）与 CVaR**：
- VaR($\alpha$)：在置信水平 $1-\alpha$ 下，投资组合的最大可能损失
- CVaR（Conditional VaR）：超过 VaR 时的平均损失，比 VaR 更稳健

### 止损机制的数学原理

止损本质上是一个期权（卖出权）的执行。考虑一个简单的百分比止损策略：

设止损比例为 $L$，若价格下跌 $L\%$ 则卖出。这相当于为投资组合购买了一个执行价格为 $(1-L) P_0$ 的美式看跌期权，支付的成本为预期损失。

设资产价格服从几何布朗运动，则触发止损的概率为：
$$ P(\text{Stop Loss}) = P(\min_{0 \leq t \leq T} \frac{P_t}{P_0} \leq 1-L) $$

在实务中，止损的有效性取决于：
1. **流动性**：若市场流动性枯竭，止损无法及时执行
2. **跳空风险**：开盘跳空可能直接跌破止损线
3. **波动性**：高波动环境下止损易被"噪音"触发

### 动态止损（Trailing Stop）

动态止损止损线随价格上涨而提升，锁定利润的同时保留上涨空间：

$$ Stop_t = \max(P_t \times (1-L), Stop_{t-1}) $$

## 行为金融视角下的风险管理

### 行为偏差

**1. 过度自信（Overconfidence）**：
- 投资者高估自己的信息和能力
- 表现为交易过度、分散化不足、仓位过高
- 对策：强制分散化、记录和评估决策、承认局限性

**2. 损失厌恶（Loss Aversion）**：
- 根据前景理论（Prospect Theory），损失的痛苦是等额收益快乐的约2-2.5倍
- 表现为：不愿止损、抱有幻想、过度持有亏损股
- 对策：设定客观止损规则、委托他人执行、关注长期目标

**3. 确认偏差（Confirmation Bias）**：
- 倾向于寻找和记住支持自己观点的证据
- 忽略反面信息
- 对策：主动寻找反面观点、定期假设自己观点错误

**4. 锚定效应（Anchoring）**：
- 过度依赖初始信息（如买入价）
- 下跌中无法客观评估当前价值
- 对策：关注基本面变化、重新估值、忘记买入价

### 情绪周期的数学模型

投资者的情绪周期常被建模为：
$$ E_t = \alpha E_{t-1} + \beta R_t + \epsilon_t $$

其中 $E_t$ 为情绪水平，$\alpha$ 为情绪持续系数，$\beta$ 为收益对情绪的影响系数。

在市场极端情绪下（极度贪婪或恐惧），逆向策略往往有效：
$$ \text{Contrarian Signal} = - \text{Normalized Sentiment}_t $$

## 风险预算与压力测试

### 风险预算（Risk Budgeting）

风险预算将总风险分配到不同的因子或资产上：

$$ Total Risk = \sum_{i=1}^{N} RB_i $$

其中 $RB_i$ 为分配给因子 i 的风险预算。

常见分配方式：
- 按因子风险暴露分配
- 按行业分配
- 按地域分配

**约束**：
$$ \sum_{i=1}^{N} w_i = 1 $$
$$ \sigma_p^2 \leq \sigma_{target}^2 $$

### 压力测试（Stress Testing）

压力测试模拟极端市场场景下的投资组合表现：

**历史场景**：
- 2008年金融危机
- 2020年疫情冲击
- 2000年互联网泡沫破裂

**假设场景**：
- 利率上升300bps
- 通胀飙升至10%
- 股市下跌40%

**蒙特卡洛模拟**：
基于统计分布，模拟大量可能的未来路径，计算组合收益分布：
$$ \hat{R}_t = \sum_{i=1}^{N} w_i \hat{R}_{i,t} $$
其中 $\hat{R}_{i,t}$ 为资产 i 在路径 t 上的模拟收益。

---

*参考资料：Markowitz (1952), Sharpe (1964), Kelly (1956), MacLean et al. (2011)*

上一篇：估值方法理论与模型 | 下一篇：行业分析
